# NovelGrok - AI小说写作工具

一个基于Python和Grok API的智能小说写作工具。

## 🎯 核心特性

- 📚 **智能上下文管理**: 分层上下文架构，解决token限制问题
- 👥 **深度角色追踪**: 自动追踪角色经历、关系演变、性格变化（增强版）
- � **角色别名识别**: AI自动识别并统一角色的多个称呼（新功能✨）
- �📖 **情节连贯管理**: 跟踪故事线索和重要事件，保持逻辑一致
- 🧠 **自动摘要生成**: 为长章节生成摘要，优化上下文使用
- 📝 **多种写作模式**: 新章节生成、续写、改进等多种模式
- 💾 **完整项目管理**: 项目保存、加载、导出等完整功能
- 🌐 **Web可视化界面**: 美观易用的Web界面，所见即所得
- 📥 **小说导入功能**: 导入现有小说，自动分章节和角色提取
- 🤖 **AI智能分析**: 一键分析项目类型、背景和故事大纲
- 📖 **阅读器角色追踪**: 阅读时实时查看章节相关角色动态

## 🧠 上下文问题解决方案

### 传统AI写作的问题
- **Token窗口限制**: 无法处理长篇小说的完整上下文
- **信息遗忘**: 角色设定和早期情节容易被遗忘
- **一致性缺失**: 角色性格、故事逻辑出现矛盾

### 我们的创新解决方案

#### 1. 分层上下文架构
```
上下文分配策略:
├── 基础信息 (30%) ── 角色设定、故事背景、大纲
├── 近期内容 (50%) ── 最近2-3章的完整文本  
└── 历史摘要 (20%) ── 早期章节的关键信息
```

#### 2. 智能Token优化
- **动态内容选择**: 根据当前写作需要选择最相关的历史内容
- **自动摘要压缩**: 将冗长章节压缩为关键信息点
- **Token预算管理**: 智能分配token使用，最大化有效信息密度

## 📦 快速开始

### 安装依赖

```bash
# 安装python3.12
# 使用venv创建一个干净的环境
# pip install -r requirements.txt
```

### 配置API

1. 复制 `.env.example` 到 `.env`
2. 在 `.env` 中设置你的Grok API密钥：
```env
XAI_API_KEY=your_grok_api_key_here
XAI_BASE_URL=https://api.x.ai/v1

# 可选配置
MAX_OUTLINE_CHAPTERS=100  # 大纲模式最多生成章节数（默认100）
ENABLE_OUTLINE_MODE=True  # 是否启用大纲模式（默认True）
ENABLE_IMPORT_NOVEL=True  # 是否启用小说导入功能（默认True）
```

### 配置 Web 访问密码（重要！）

**默认密码**: `novelgrok2024`

**生产环境请务必修改密码：**

```bash
# 方法: 使用密码设置工具（推荐）
python set_password.py

# 将输出的哈希值添加到 .env 文件：
# WEB_PASSWORD_HASH=pbkdf2:sha256:...
```

**安全建议**:
- ✅ 使用强密码（至少8位，包含字母、数字、特殊字符）
- ✅ 定期更换密码
- ✅ 不要将密码明文保存在代码或配置文件中

## 🚀 使用方法

### 🌐 Web界面（推荐）

```bash
# 启动Web服务器
python web_api.py

# 在浏览器中访问
http://localhost:5001

# 首次访问需要登录（默认密码: novelgrok2024）
```

**Web界面功能**：
- ✅ 创建和管理项目
- ✅ 添加和编辑角色
- ✅ 查看角色经历
- ✅ 手动添加和编辑章节
- ✅ AI生成新章节
- ✅ 获取情节建议
- ✅ 实时统计数据可视化
- ✅ 美观的现代化界面
- ✅ **📥 小说导入功能** - 支持导入现有小说并自动提取角色
- ✅ **🤖 AI一键分析** - 自动分析小说类型、背景设定和故事大纲（新功能）

### 📥 小说导入功能

**功能说明**：
NovelGrok现在支持导入已有的小说文本，自动切分章节并提取角色信息。

## TODO
向量数据库？

## 📄 许可证
MIT License

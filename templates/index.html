<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovelGrok - AIå°è¯´å†™ä½œå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: calc(100vh - 200px);
        }

        .sidebar {
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #e0e0e0;
        }

        .project-list {
            margin-top: 20px;
        }

        .project-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .project-item:hover {
            transform: translateX(5px);
            border-color: #667eea;
        }

        .project-item.active {
            background: #667eea;
            color: white;
        }

        .project-item h3 {
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .project-item .meta {
            font-size: 0.85em;
            opacity: 0.7;
        }

        .project-item-content {
            cursor: pointer;
        }

        .delete-project-btn {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.3);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .delete-project-btn:hover {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
            transform: scale(1.1);
        }

        .project-item.active .delete-project-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: rgba(255, 255, 255, 0.5);
        }

        .project-item.active .delete-project-btn:hover {
            background: rgba(220, 53, 69, 0.9);
            border-color: #dc3545;
        }

        .content-area {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .character-card,
        .chapter-card {
            position: relative;
        }

        .card-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            padding: 8px 12px;
            background: #f8f9fa;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* åˆ«åæ ‡ç­¾æ ·å¼ */
        .aliases-container {
            display: inline-flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        .alias-tag {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .alias-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
        }

        .aliases-text {
            font-size: 0.85em;
            color: #999;
            margin-top: 2px;
            font-style: italic;
            border: 1px solid #bee5eb;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .chapter-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        /* è§’è‰²è¿½è¸ªæ ·å¼ */
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .relationship-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .relationship-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-right: 15px;
        }

        .rel-friend { background: #28a745; color: white; }
        .rel-enemy { background: #dc3545; color: white; }
        .rel-family { background: #6f42c1; color: white; }
        .rel-lover { background: #e83e8c; color: white; }
        .rel-mentor { background: #20c997; color: white; }
        .rel-rival { background: #fd7e14; color: white; }
        .rel-neutral { background: #6c757d; color: white; }

        .intimacy-bar {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 15px;
        }

        .intimacy-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .trait-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .trait-name {
            font-weight: bold;
            min-width: 120px;
        }

        .trait-bar {
            flex: 1;
            height: 15px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 15px;
        }

        .trait-fill {
            height: 100%;
            background: #667eea;
            transition: width 0.3s;
        }

        /* === ç°ä»£åŒ–è§’è‰²è¿½è¸ªæ ·å¼ === */
        
        .relationship-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .relationship-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .relationship-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .relationship-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .relationship-icon {
            font-size: 24px;
        }

        .relationship-target {
            font-size: 18px;
            font-weight: bold;
            flex: 1;
        }

        .relationship-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .intimacy-section {
            margin-bottom: 15px;
        }

        .intimacy-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #666;
        }

        .intimacy-value {
            font-weight: bold;
            font-size: 16px;
        }

        .intimacy-bar-modern {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .intimacy-fill-modern {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .relationship-desc {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .relationship-desc p {
            margin: 0;
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .relationship-evolution {
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
        }

        .relationship-history {
            margin-top: 10px;
        }

        .btn-link {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            font-size: 13px;
            text-decoration: underline;
        }

        .btn-link:hover {
            color: #764ba2;
        }

        /* å…³ç³»å†å²æ—¶é—´çº¿æ ·å¼ */
        
        .history-timeline {
            position: relative;
            padding-left: 40px;
            margin: 20px 0;
        }

        .history-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .history-item {
            position: relative;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .history-item::before {
            content: '';
            position: absolute;
            left: -31px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #667eea;
        }

        .history-chapter {
            display: inline-block;
            padding: 3px 10px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .history-change {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            font-size: 15px;
        }

        .history-value {
            padding: 5px 12px;
            background: white;
            border-radius: 8px;
            font-weight: bold;
        }

        .history-arrow {
            font-size: 18px;
            color: #999;
        }

        .history-trend-up {
            color: #4caf50;
        }

        .history-trend-down {
            color: #f44336;
        }

        .history-reason {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-left: 3px solid #667eea;
            border-radius: 4px;
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        /* è§’è‰²é€‰æ‹©å™¨æ ·å¼ */
        
        .character-selector {
            position: relative;
            margin-bottom: 30px;
        }

        .character-selector-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .character-selector-button {
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .character-selector-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .character-selector-button .icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .character-selector-button .text {
            flex: 1;
            text-align: left;
        }

        .character-selector-button .arrow {
            font-size: 12px;
            transition: transform 0.3s;
        }

        .character-selector-button.active .arrow {
            transform: rotate(180deg);
        }

        .character-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            margin-top: 8px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .character-dropdown.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .character-option {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .character-option:last-child {
            border-bottom: none;
        }

        .character-option:hover {
            background: #f8f9fa;
        }

        .character-option.selected {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-left: 3px solid #667eea;
        }

        .character-option .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .character-option .info {
            flex: 1;
        }

        .character-option .name {
            font-weight: 600;
            font-size: 15px;
            color: #333;
            margin-bottom: 2px;
        }

        .character-option .desc {
            font-size: 12px;
            color: #999;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* åˆ›ä½œæ¨¡å¼é€‰æ‹©å™¨ */
        
        .mode-selector {
            display: flex;
            gap: 10px;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 12px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn:hover {
            background: #e9ecef;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .creation-mode {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¤§çº²å¡ç‰‡æ ·å¼ */
        
        .outline-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s;
            border-left: 4px solid #e9ecef;
        }

        .outline-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .outline-item.status-planned {
            border-left-color: #ffc107;
        }

        .outline-item.status-generated {
            border-left-color: #2196f3;
        }

        .outline-item.status-completed {
            border-left-color: #4caf50;
        }

        .outline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .outline-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .outline-status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-planned { background: #fff3cd; color: #856404; }
        .status-generated { background: #cce5ff; color: #004085; }
        .status-completed { background: #d4edda; color: #155724; }

        .outline-summary {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .outline-events {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .outline-events h5 {
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
        }

        .outline-events ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .outline-events li {
            padding: 5px 0 5px 20px;
            position: relative;
            color: #666;
            font-size: 14px;
        }

        .outline-events li:before {
            content: 'â–¸';
            position: absolute;
            left: 0;
            color: #667eea;
        }

        .outline-actions {
            display: flex;
            gap: 10px;
        }

        .outline-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            text-align: center;
        }

        .stat-box .number {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-box .label {
            font-size: 14px;
            color: #999;
        }

        /* æ€§æ ¼ç‰¹è´¨ç°ä»£åŒ–æ ·å¼ */
        
        .personality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .trait-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            transition: all 0.3s;
        }

        .trait-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .trait-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .trait-name-modern {
            font-weight: bold;
            font-size: 15px;
            color: #333;
        }

        .trait-trend {
            font-size: 18px;
        }

        .trait-visual {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .trait-bar-modern {
            flex: 1;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .trait-fill-modern {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .trait-value {
            font-weight: bold;
            font-size: 14px;
            min-width: 30px;
            text-align: right;
        }

        .trait-desc, .trait-change {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        /* æ€§æ ¼æ¼”å˜æ—¶é—´çº¿ */
        
        .personality-evolution {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .evolution-timeline {
            position: relative;
            padding-left: 20px;
        }

        .evolution-item {
            position: relative;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            border-left: 4px solid #4caf50;
        }

        .evolution-item.decrease {
            border-left-color: #f44336;
        }

        .evolution-chapter {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }

        .evolution-trait {
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 8px;
        }

        .evolution-change {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .old-value {
            color: #999;
        }

        .arrow {
            color: #667eea;
            font-weight: bold;
        }

        .new-value {
            font-weight: bold;
            color: #333;
        }

        .change-value {
            font-size: 13px;
            font-weight: bold;
        }

        .evolution-reason {
            padding-top: 8px;
            border-top: 1px solid #f0f0f0;
            color: #666;
            font-size: 13px;
        }

        .timeline-item {
            position: relative;
            padding-left: 40px;
            padding-bottom: 25px;
            border-left: 2px solid #e0e0e0;
        }

        .timeline-item:last-child {
            border-left: none;
        }

        .timeline-dot {
            position: absolute;
            left: -8px;
            top: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #e0e0e0;
        }

        .timeline-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .timeline-type {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .type-experience { background: #ffc107; color: #333; }
        .type-relationship { background: #17a2b8; color: white; }
        .type-personality { background: #6f42c1; color: white; }

        .growth-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .growth-stat-label {
            font-weight: 500;
        }

        .growth-stat-value {
            font-weight: bold;
            color: #667eea;
        }

        /* è¿›åº¦æç¤ºæ ·å¼ä¼˜åŒ– */
        #progressModal .spinner {
            width: 60px;
            height: 60px;
            border-width: 6px;
        }

        #progressModal .loading {
            padding: 30px;
        }

        #progressModal .modal-content {
            animation: slideUp 0.4s ease-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        #progressTimer {
            animation: pulse 2s infinite;
        }

        /* Toggle å¼€å…³æ ·å¼ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 34px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
            box-shadow: 0 2px 12px rgba(102, 126, 234, 0.4);
        }

        .toggle-switch:hover .toggle-slider {
            box-shadow: 0 0 16px rgba(102, 126, 234, 0.3);
        }

        .toggle-slider:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 8px;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: transparent;
            transition: opacity 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider:after {
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto;">
                <div style="flex: 1;">
                    <h1>ğŸ“š NovelGrok</h1>
                    <p>AIé©±åŠ¨çš„æ™ºèƒ½å°è¯´å†™ä½œåŠ©æ‰‹</p>
                    <div id="apiBalance" style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                        <span id="balanceInfo">æ­£åœ¨æ£€æŸ¥APIçŠ¶æ€...</span>
                    </div>
                </div>
                <button 
                    onclick="logout()" 
                    style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.95em; font-weight: 500; transition: all 0.3s; backdrop-filter: blur(10px);"
                    onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.borderColor='white';"
                    onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.borderColor='rgba(255,255,255,0.5)';"
                >
                    ğŸšª é€€å‡ºç™»å½•
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <button class="btn" style="width: 100%; margin-bottom: 10px;" onclick="showCreateProjectModal()">
                    â• åˆ›å»ºæ–°é¡¹ç›®
                </button>
                <button class="btn btn-secondary" style="width: 100%;" onclick="showImportNovelModal()">
                    ğŸ“¥ å¯¼å…¥å°è¯´
                </button>
                
                <div class="project-list" id="projectList">
                    <div class="loading active">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px;">åŠ è½½ä¸­...</p>
                    </div>
                </div>
            </div>

            <div class="content-area">
                <div id="emptyState" class="empty-state">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                    </svg>
                    <h2>é€‰æ‹©ä¸€ä¸ªé¡¹ç›®å¼€å§‹</h2>
                    <p>ä»å·¦ä¾§é€‰æ‹©ç°æœ‰é¡¹ç›®ï¼Œæˆ–åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®</p>
                </div>

                <div id="projectContent" style="display: none;">
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('overview', event)">ğŸ“Š æ¦‚è§ˆ</button>
                        <button class="tab" onclick="switchTab('characters', event)">ğŸ‘¥ è§’è‰²</button>
                        <button class="tab" onclick="switchTab('tracking', event)">ğŸ“ˆ è§’è‰²è¿½è¸ª</button>
                        <button class="tab" onclick="switchTab('chapters', event)">ğŸ“– ç« èŠ‚</button>
                        <button class="tab" onclick="switchTab('ai', event)">ğŸ¤– AIåˆ›ä½œ</button>
                    </div>

                    <!-- æ¦‚è§ˆæ ‡ç­¾ -->
                    <div id="overview" class="tab-content active">
                        <div class="stats" id="stats"></div>
                        
                        <div class="card">
                            <h3>é¡¹ç›®ä¿¡æ¯</h3>
                            <div id="projectInfo"></div>
                            <div style="margin-top: 15px;">
                                <button class="btn" onclick="showEditProjectModal()">ç¼–è¾‘é¡¹ç›®</button>
                                <button class="btn btn-danger" onclick="deleteProject()" style="margin-left: 10px;">åˆ é™¤é¡¹ç›®</button>
                                <button class="btn" onclick="analyzeProjectWithAI()" style="margin-left: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    ğŸ¤– AIä¸€é”®åˆ†æ
                                </button>
                                <button class="btn" onclick="downloadNovel()" style="margin-left: 10px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                    ğŸ“¥ ä¸‹è½½å°è¯´
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- è§’è‰²æ ‡ç­¾ -->
                    <div id="characters" class="tab-content">
                        <div class="action-buttons">
                            <button class="btn" onclick="showAddCharacterModal()">â• æ·»åŠ è§’è‰²</button>
                        </div>
                        <div id="characterList"></div>
                    </div>

                    <!-- è§’è‰²è¿½è¸ªæ ‡ç­¾ -->
                    <div id="tracking" class="tab-content">
                        <div class="character-selector">
                            <label class="character-selector-label">é€‰æ‹©è¦æŸ¥çœ‹çš„è§’è‰²</label>
                            <button class="character-selector-button" onclick="toggleCharacterDropdown()" id="characterSelectorButton">
                                <span class="icon">ğŸ‘¤</span>
                                <span class="text" id="selectedCharacterText">è¯·é€‰æ‹©è§’è‰²</span>
                                <span class="arrow">â–¼</span>
                            </button>
                            <div class="character-dropdown" id="characterDropdown"></div>
                        </div>

                        <div id="trackingContent" style="display:none;">
                            <!-- è§’è‰²åŸºæœ¬ä¿¡æ¯ -->
                            <div class="card" id="characterInfoCard">
                                <h3>ğŸ‘¤ è§’è‰²ä¿¡æ¯</h3>
                                <div id="characterBasicInfo"></div>
                            </div>

                            <!-- å…³ç³»ç½‘ç»œå›¾ -->
                            <div class="card">
                                <h3>ğŸ”— å…³ç³»ç½‘ç»œ</h3>
                                <div id="relationshipNetwork"></div>
                            </div>

                            <!-- æ€§æ ¼ç‰¹è´¨ -->
                            <div class="card">
                                <h3>ğŸ§  æ€§æ ¼ç‰¹è´¨</h3>
                                <div id="personalityTraits"></div>
                            </div>

                            <!-- æˆé•¿åˆ†æ -->
                            <div class="card">
                                <h3>ğŸ“Š æˆé•¿åˆ†æ</h3>
                                <div id="growthAnalysis"></div>
                            </div>

                            <!-- æ—¶é—´çº¿ -->
                            <div class="card">
                                <h3>â° å®Œæ•´æ—¶é—´çº¿</h3>
                                <div id="characterTimeline"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ç« èŠ‚æ ‡ç­¾ -->
                    <div id="chapters" class="tab-content">
                        <div class="action-buttons">
                            <button class="btn" onclick="showAddChapterModal()">â• æ‰‹åŠ¨æ·»åŠ ç« èŠ‚</button>
                        </div>
                        <div id="chapterList"></div>
                    </div>

                    <!-- AIåˆ›ä½œæ ‡ç­¾ -->
                    <div id="ai" class="tab-content">
                        <!-- åˆ›ä½œæ¨¡å¼é€‰æ‹© -->
                        <div class="mode-selector" style="margin-bottom: 20px;">
                            <button class="mode-btn active" onclick="switchCreationMode('direct')" id="directModeBtn">
                                âš¡ ç›´æ¥ç”Ÿæˆ
                            </button>
                            <button class="mode-btn" onclick="switchCreationMode('outline')" id="outlineModeBtn">
                                ğŸ“‹ å¤§çº²æ¨¡å¼
                            </button>
                            <button class="mode-btn" onclick="switchCreationMode('shortStory')" id="shortStoryModeBtn">
                                ğŸ“– çŸ­ç¯‡æ¨¡å¼
                            </button>
                        </div>

                        <!-- ç›´æ¥ç”Ÿæˆæ¨¡å¼ -->
                        <div id="directMode" class="creation-mode">
                            <div class="card">
                                <h3>ğŸ¯ ç”Ÿæˆæ–°ç« èŠ‚</h3>
                                <p style="color: #666; margin-bottom: 15px;">
                                    ğŸ’¡ <strong>è¯´æ˜</strong>ï¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç« èŠ‚ï¼Œæ·»åŠ åˆ°å°è¯´æœ«å°¾ï¼Œæ¨è¿›æ•…äº‹å‘å±•
                                </p>
                            <div class="form-group">
                                <label>ç« èŠ‚æ ‡é¢˜ï¼ˆå¯é€‰ï¼ŒAIä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="aiChapterTitle" placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸€æ¬¡ç›¸é‡" style="flex: 1;">
                                    <button class="btn btn-secondary" onclick="generateChapterIdea()" style="white-space: nowrap; padding: 8px 15px;">
                                        âœ¨ AIç”Ÿæˆåˆ›æ„
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>å†™ä½œæç¤º</label>
                                <textarea id="aiChapterPrompt" placeholder="æè¿°ä½ æƒ³è¦çš„æƒ…èŠ‚ã€åœºæ™¯æˆ–é£æ ¼..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>ç›®æ ‡å­—æ•°</label>
                                <input type="number" id="aiChapterLength" value="3500" min="500" max="20000" step="500">
                                <p style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                    ğŸ’¡ æ¨èï¼š1500-3000å­—ï¼ˆè´¨é‡æ›´å¥½ï¼‰ã€‚4000å­—ä»¥ä¸Šç”Ÿæˆæ—¶é—´è¾ƒé•¿ã€‚
                                </p>
                            </div>
                            <div class="form-group" style="background: linear-gradient(135deg, #f5f7fa 0%, #e8eaf6 100%); padding: 15px; border-radius: 10px; border: 2px solid #e1e8ed;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                            <span style="font-size: 1em; font-weight: 600; color: #2c3e50;">ğŸ“ è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦</span>
                                        </div>
                                        <small style="color: #7f8c8d;">ä¸ºç« èŠ‚ç”ŸæˆAIæ‘˜è¦ï¼Œä¾¿äºåç»­ä¸Šä¸‹æ–‡ç®¡ç†</small>
                                    </div>
                                    <label class="toggle-switch" style="margin-left: 15px;">
                                        <input type="checkbox" id="aiGenerateSummary">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <button class="btn" id="generateChapterBtn" onclick="confirmAndGenerate()">ğŸš€ ç”Ÿæˆç« èŠ‚</button>
                            <p style="font-size: 0.9em; color: #999; margin-top: 10px; text-align: center;">
                                â±ï¸ é¢„è®¡è€—æ—¶ï¼š1-3åˆ†é’Ÿ Â· ç”ŸæˆæœŸé—´å¯åˆ‡æ¢æ ‡ç­¾é¡µ
                            </p>
                        </div>
                        </div>

                        <!-- å¤§çº²æ¨¡å¼ -->
                        <div id="outlineMode" class="creation-mode" style="display: none;">
                            <!-- å¤§çº²çŠ¶æ€å¡ç‰‡ -->
                            <div class="card" id="outlineStatusCard">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h3>ğŸ“‹ ç« èŠ‚å¤§çº²</h3>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn btn-secondary" onclick="showGenerateOutlineDialog()">
                                            âœ¨ AIç”Ÿæˆå®Œæ•´å¤§çº²
                                        </button>
                                        <button class="btn btn-secondary" id="appendOutlineBtn" onclick="showAppendOutlineDialog()" style="display: none;">
                                            â• ç»§ç»­ç”Ÿæˆ
                                        </button>
                                    </div>
                                </div>
                                <div id="outlineStatus"></div>
                                
                                <!-- æ‰¹é‡ç”Ÿæˆå·¥å…·æ  -->
                                <div id="batchGenerateBar" style="display: none; margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <h4 style="margin: 0 0 5px 0; color: white;">âš¡ ä¸€é”®æ‰¹é‡ç”Ÿæˆ</h4>
                                            <small style="opacity: 0.9;">é€‰æ‹©ç« èŠ‚èŒƒå›´ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æŒ‰é¡ºåºç”Ÿæˆæ‰€æœ‰ç« èŠ‚</small>
                                        </div>
                                        <button class="btn" onclick="showBatchGenerateDialog()" style="background: white; color: #667eea; font-weight: 600;">
                                            ğŸš€ å¼€å§‹æ‰¹é‡ç”Ÿæˆ
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- æ‰¹é‡ç”Ÿæˆè¿›åº¦æ¡ -->
                                <div id="batchGenerateProgress" style="display: none; margin-top: 15px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <div>
                                            <h4 style="margin: 0 0 5px 0; color: #667eea;">ğŸ“Š æ‰¹é‡ç”Ÿæˆè¿›åº¦</h4>
                                            <div id="batchProgressText" style="color: #666;">å‡†å¤‡ä¸­...</div>
                                        </div>
                                        <button class="btn btn-secondary" onclick="cancelBatchGenerate()" id="cancelBatchBtn">
                                            â¸ï¸ å–æ¶ˆç”Ÿæˆ
                                        </button>
                                    </div>
                                    <div style="width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden; margin-top: 10px;">
                                        <div id="batchProgressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s;"></div>
                                    </div>
                                    <div id="batchProgressDetails" style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                        <!-- è¯¦ç»†è¿›åº¦ä¿¡æ¯ -->
                                    </div>
                                </div>
                                
                                <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
                                <div id="bulkActionBar" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span id="selectedCount" style="color: #667eea; font-weight: 500;">å·²é€‰æ‹© 0 ç« </span>
                                        <div style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary" onclick="showRegenerateRangeDialog()">
                                                ğŸ”„ é‡æ–°ç”Ÿæˆæ‰€é€‰å¤§çº²
                                            </button>
                                            <button class="btn btn-secondary" onclick="clearSelection()">
                                                å–æ¶ˆé€‰æ‹©
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å¤§çº²åˆ—è¡¨ -->
                            <div id="outlineList"></div>
                        </div>
                    </div>

                        <!-- çŸ­ç¯‡å°è¯´æ¨¡å¼ -->
                        <div id="shortStoryMode" class="creation-mode" style="display: none;">
                            <div class="card" style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border: none; margin-bottom: 20px;">
                                <h3 style="color: #2d3436;">ğŸ“– çŸ­ç¯‡å°è¯´åˆ›ä½œæ¨¡å¼</h3>
                                <p style="color: #2d3436; margin-bottom: 10px;">
                                    é€‚åˆ10-20ç« çš„çŸ­ç¯‡æ•…äº‹ï¼Œæ³¨é‡æ•´ä½“è¿è´¯æ€§å’Œä¼ç¬”å›æ”¶
                                </p>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px;">
                                    <div style="background: rgba(255,255,255,0.5); padding: 10px; border-radius: 8px;">
                                        <div style="font-weight: 600;">âœ¨ æ•´ä½“è§„åˆ’</div>
                                        <small>å…ˆç”Ÿæˆå®Œæ•´å¤§çº²</small>
                                    </div>
                                    <div style="background: rgba(255,255,255,0.5); padding: 10px; border-radius: 8px;">
                                        <div style="font-weight: 600;">ğŸ”— è‡ªç„¶è¡”æ¥</div>
                                        <small>ç« èŠ‚é—´æ— æ–­è£‚æ„Ÿ</small>
                                    </div>
                                    <div style="background: rgba(255,255,255,0.5); padding: 10px; border-radius: 8px;">
                                        <div style="font-weight: 600;">ğŸ¯ ä¼ç¬”è¿½è¸ª</div>
                                        <small>è‡ªåŠ¨ç®¡ç†å’Œå›æ”¶</small>
                                    </div>
                                </div>
                            </div>

                            <!-- ç¬¬ä¸€æ­¥ï¼šæ•…äº‹æ ¸å¿ƒ -->
                            <div class="card" id="shortStoryStep1">
                                <h3>ğŸ“ ç¬¬ä¸€æ­¥ï¼šç¡®å®šæ•…äº‹æ ¸å¿ƒ</h3>
                                <div class="form-group">
                                    <label>æ•…äº‹æ ¸å¿ƒ</label>
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                        <button class="btn btn-secondary" onclick="generateStoryCores()" id="generateCoresBtn">
                                            ğŸ¤– AI ç”Ÿæˆ 3 ä¸ªæ•…äº‹æ ¸å¿ƒæ–¹æ¡ˆ
                                        </button>
                                        <button class="btn btn-secondary" onclick="showManualCoreInput()">
                                            âœï¸ æ‰‹åŠ¨è¾“å…¥
                                        </button>
                                    </div>
                                    <div id="storyCoreOptions" style="display: none; margin-top: 15px;">
                                        <!-- AI ç”Ÿæˆçš„æ•…äº‹æ ¸å¿ƒé€‰é¡¹ -->
                                    </div>
                                    <div id="manualCoreInput" style="display: none; margin-top: 15px;">
                                        <textarea id="shortStoryCore" placeholder="è¯·æè¿°æ•…äº‹çš„æ ¸å¿ƒä¸»é¢˜å’Œä¸»è¦å†²çªï¼Œä¾‹å¦‚ï¼š&#10;&#10;è¿™æ˜¯ä¸€ä¸ªå…³äºæ•‘èµä¸è‡ªæˆ‘å‘ç°çš„æ•…äº‹ã€‚ä¸»è§’ææ˜æ˜¯ä¸€åæ›¾ç»çš„å¤©æ‰ç¨‹åºå‘˜ï¼Œå› ä¸ºä¸€æ¬¡é‡å¤§çš„æŠ€æœ¯å¤±è¯¯å¯¼è‡´å…¬å¸ç ´äº§ã€åŒäº‹å¤±ä¸šã€‚åœ¨ä¼—äººæŒ‡è´£å’Œè‡ªè´£ä¸­ï¼Œä»–é€‰æ‹©é€ƒé¿åˆ°ä¸€ä¸ªåè¿œå°é•‡ã€‚åœ¨é‚£é‡Œï¼Œä»–é‡åˆ°äº†ä¸€ç¾¤æ·³æœ´çš„æ‘æ°‘å’Œä¸€ä¸ªéœ€è¦æŠ€æœ¯å¸®åŠ©çš„ç•™å®ˆå„¿ç«¥å­¦æ ¡ã€‚é€šè¿‡å¸®åŠ©è¿™äº›å­©å­æ­å»ºåœ¨çº¿æ•™è‚²å¹³å°ï¼Œææ˜é€æ¸æ‰¾å›äº†å¯¹æŠ€æœ¯çš„çƒ­çˆ±å’Œå¯¹ç”Ÿæ´»çš„ä¿¡å¿ƒï¼Œæœ€ç»ˆå‹‡æ•¢é¢å¯¹è¿‡å»çš„é”™è¯¯ï¼Œå¹¶ç”¨è‡ªå·±çš„æ–¹å¼è¡¥å¿äº†æ›¾ç»ä¼¤å®³è¿‡çš„äººã€‚&#10;&#10;æ•…äº‹å°†æ¢è®¨ï¼šç§‘æŠ€ä¸äººæ€§ã€é€ƒé¿ä¸é¢å¯¹ã€ä¸ªäººä»·å€¼çš„é‡æ–°å‘ç°ç­‰ä¸»é¢˜ã€‚" rows="8"></textarea>
                                        <button class="btn" onclick="confirmStoryCore()" style="margin-top: 10px;">ç¡®è®¤æ•…äº‹æ ¸å¿ƒ</button>
                                    </div>
                                </div>
                            </div>

                            <!-- ç¬¬äºŒæ­¥ï¼šåˆ›ä½œå‚æ•°é…ç½® -->
                            <div class="card" id="shortStoryStep2" style="display: none;">
                                <h3>âš™ï¸ ç¬¬äºŒæ­¥ï¼šé…ç½®åˆ›ä½œå‚æ•°</h3>
                                <div class="form-group">
                                    <label>æ€»ç« èŠ‚æ•° *</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <input type="number" id="shortStoryTotalChapters" value="15" min="5" max="30" style="width: 150px;">
                                        <small style="color: #666;">æ¨è 10-20 ç« </small>
                                        <button class="btn btn-secondary" onclick="aiSuggestChapterCount()" style="padding: 5px 15px; font-size: 0.9em;">
                                            ğŸ¤– AI å»ºè®®
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>æ¯ç« å¹³å‡å­—æ•° *</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <input type="number" id="shortStoryChapterLength" value="2000" min="1000" max="4000" step="100" style="width: 150px;">
                                        <small style="color: #666;">æ¨è 1500-2500 å­—</small>
                                        <button class="btn btn-secondary" onclick="aiSuggestChapterLength()" style="padding: 5px 15px; font-size: 0.9em;">
                                            ğŸ¤– AI å»ºè®®
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>æ•…äº‹èŠ‚å¥</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <select id="shortStoryPace" style="width: 200px;">
                                            <option value="fast">å¿«èŠ‚å¥ï¼ˆç´§å‡‘åˆºæ¿€ï¼‰</option>
                                            <option value="moderate" selected>ä¸­ç­‰èŠ‚å¥ï¼ˆå¹³è¡¡å‘å±•ï¼‰</option>
                                            <option value="slow">æ…¢èŠ‚å¥ï¼ˆç»†è…»æå†™ï¼‰</option>
                                        </select>
                                        <button class="btn btn-secondary" onclick="aiSuggestPace()" style="padding: 5px 15px; font-size: 0.9em;">
                                            ğŸ¤– AI å»ºè®®
                                        </button>
                                    </div>
                                </div>
                                <div style="text-align: center; margin-top: 20px;">
                                    <button class="btn" onclick="generateOutlinePreview()" style="font-size: 1.1em; padding: 12px 30px;">
                                        ğŸ“‹ ç”Ÿæˆå¤§çº²é¢„è§ˆ
                                    </button>
                                </div>
                            </div>

                            <!-- ç¬¬ä¸‰æ­¥ï¼šå¤§çº²é¢„è§ˆ -->
                            <div class="card" id="shortStoryStep3" style="display: none;">
                                <h3>ğŸ“‹ ç¬¬ä¸‰æ­¥ï¼šå¤§çº²é¢„è§ˆä¸è°ƒæ•´</h3>
                                <div id="outlinePreviewArea" style="margin-top: 15px;">
                                    <!-- å¤§çº²é¢„è§ˆå†…å®¹ -->
                                </div>
                                <div style="text-align: center; margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                                    <button class="btn btn-secondary" onclick="regenerateOutline()">
                                        ğŸ”„ é‡æ–°ç”Ÿæˆå¤§çº²
                                    </button>
                                    <button class="btn" onclick="proceedToForeshadowing()">
                                        â¡ï¸ ç»§ç»­ï¼šè®¾ç½®ä¼ç¬”
                                    </button>
                                </div>
                            </div>

                            <!-- ç¬¬å››æ­¥ï¼šä¼ç¬”è®¾ç½® -->
                            <div class="card" id="shortStoryStep4" style="display: none;">
                                <h3>ğŸ¯ ç¬¬å››æ­¥ï¼šä¼ç¬”è®¾ç½®ï¼ˆå¯é€‰ï¼‰</h3>
                                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                                    æ ¹æ®å¤§çº²è®¾ç½®ä¼ç¬”ï¼ŒAI ä¼šç¡®ä¿è¿™äº›ä¼ç¬”åœ¨åç»­ç« èŠ‚ä¸­è‡ªç„¶å›æ”¶
                                </p>
                                <div style="margin-bottom: 15px;">
                                    <button class="btn btn-secondary" onclick="aiGenerateForeshadowings()" style="margin-bottom: 15px;">
                                        ğŸ¤– AI è‡ªåŠ¨æå–ä¼ç¬”
                                    </button>
                                </div>
                                <div id="foreshadowingList" style="margin-bottom: 15px;">
                                    <!-- ä¼ç¬”åˆ—è¡¨ -->
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-secondary" onclick="showAddForeshadowingDialog()">
                                        â• æ‰‹åŠ¨æ·»åŠ ä¼ç¬”
                                    </button>
                                </div>
                                <div style="text-align: center; margin-top: 20px;">
                                    <button class="btn" onclick="startFullGeneration()" style="font-size: 1.2em; padding: 15px 40px;">
                                        ğŸš€ å¼€å§‹å®Œæ•´åˆ›ä½œ
                                    </button>
                                    <p style="color: #999; margin-top: 10px; font-size: 0.9em;">
                                        â±ï¸ é¢„è®¡è€—æ—¶ï¼šçº¦ <span id="estimatedTime">10-15</span> åˆ†é’Ÿ
                                    </p>
                                </div>
                            </div>

                            <!-- çŸ­ç¯‡è¿›åº¦æ˜¾ç¤º -->
                            <div class="card" id="shortStoryProgress" style="display: none;">
                                <h3>ğŸ“Š åˆ›ä½œè¿›åº¦</h3>
                                <div style="background: #f5f7fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span>è¿›åº¦:</span>
                                        <span id="shortStoryProgressText">0 / 0</span>
                                    </div>
                                    <div style="background: #e0e0e0; height: 20px; border-radius: 10px; overflow: hidden;">
                                        <div id="shortStoryProgressBar" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.3s;"></div>
                                    </div>
                                    <div id="shortStoryCurrentChapter" style="margin-top: 10px; color: #666; font-size: 0.9em;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºé¡¹ç›®æ¨¡æ€æ¡† -->
    <div id="createProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>åˆ›å»ºæ–°é¡¹ç›®</h2>
            </div>
            <div class="form-group">
                <label>é¡¹ç›®æ ‡é¢˜ *</label>
                <input type="text" id="newProjectTitle" required>
            </div>
            <div class="form-group">
                <label>ç±»å‹</label>
                <input type="text" id="newProjectGenre" placeholder="ä¾‹å¦‚ï¼šç§‘å¹»ã€å¥‡å¹»ã€æ‚¬ç–‘...">
            </div>
            <div class="form-group">
                <label>èƒŒæ™¯è®¾å®š</label>
                <textarea id="newProjectBackground" placeholder="æè¿°æ•…äº‹çš„ä¸–ç•Œè§‚å’ŒèƒŒæ™¯..."></textarea>
            </div>
            <div class="form-group">
                <label>æ•…äº‹å¤§çº²</label>
                <textarea id="newProjectOutline" placeholder="ç®€è¦æ¦‚è¿°æ•…äº‹ä¸»çº¿..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createProjectModal')">å–æ¶ˆ</button>
                <button class="btn" onclick="createProject()">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥å°è¯´æ¨¡æ€æ¡† -->
    <div id="importNovelModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>ğŸ“¥ å¯¼å…¥å°è¯´</h2>
            </div>
            <div class="form-group">
                <label>é¡¹ç›®åç§° *</label>
                <input type="text" id="importProjectTitle" required placeholder="ä¸ºå¯¼å…¥çš„å°è¯´åˆ›å»ºé¡¹ç›®åç§°">
                <small style="color: #666; display: block; margin-top: 5px;">å¦‚æœé¡¹ç›®å·²å­˜åœ¨ï¼Œç« èŠ‚å°†è¿½åŠ åˆ°è¯¥é¡¹ç›®</small>
            </div>
            <div class="form-group">
                <label>å°è¯´æ–‡æœ¬ *</label>
                <textarea id="importNovelContent" style="min-height: 300px; font-family: monospace;" 
                          placeholder="ç²˜è´´å°è¯´æ–‡æœ¬å†…å®¹...&#10;&#10;æ”¯æŒçš„ç« èŠ‚æ ‡é¢˜æ ¼å¼ï¼š&#10;- ç¬¬ä¸€ç« ï¼šæ ‡é¢˜&#10;- ç¬¬1ç«  æ ‡é¢˜&#10;- Chapter 1: Title&#10;- 1. æ ‡é¢˜&#10;ç­‰å¸¸è§æ ¼å¼"></textarea>
                <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <small id="importContentSize" style="color: #666;">0 å­—ç¬¦ (0 KB)</small>
                    <label style="cursor: pointer;">
                        <input type="file" id="importFileInput" accept=".txt" style="display: none;" onchange="handleFileSelect(event)">
                        <span class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9em; display: inline-block;">ğŸ“‚ ä»æ–‡ä»¶åŠ è½½</span>
                    </label>
                </div>
            </div>
            <div class="form-group" id="trackingOptionCard" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 12px; border: 2px solid #e1e8ed; transition: all 0.3s ease;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 1.1em; font-weight: 600; color: #2c3e50;">ğŸ¤– è‡ªåŠ¨åˆ†æè§’è‰²è¿½è¸ª</span>
                            <span style="margin-left: 8px; padding: 2px 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; font-size: 0.75em; font-weight: 500;">AIåˆ†æ</span>
                        </div>
                        <div style="margin-left: 4px;">
                            <div style="display: flex; align-items: center; margin-bottom: 4px;">
                                <span style="color: #27ae60; margin-right: 6px; font-weight: 600;">âœ“</span>
                                <small style="color: #34495e; font-weight: 500;">åŸºç¡€è§’è‰²è¯†åˆ«ï¼ˆæ€»æ˜¯æ‰§è¡Œï¼‰</small>
                            </div>
                            <div id="trackingOptionalFeature" style="display: flex; align-items: center; transition: all 0.3s ease;">
                                <span style="color: #667eea; margin-right: 6px; font-weight: 600;">âœ“</span>
                                <small style="color: #34495e; font-weight: 500;">é€ç« è¿½è¸ªï¼šè§’è‰²ç»å†ã€å…³ç³»å˜åŒ–ã€æ€§æ ¼å‘å±•</small>
                                <small style="color: #e74c3c; margin-left: 6px; font-style: italic;">ï¼ˆéœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰</small>
                            </div>
                        </div>
                    </div>
                    <label class="toggle-switch" style="margin-left: 20px;">
                        <input type="checkbox" id="importExtractCharacters" checked onchange="updateTrackingDisplay()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div id="importPreview" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <h4 style="margin-bottom: 10px;">ğŸ“‹ å¯¼å…¥é¢„è§ˆ</h4>
                <div id="importPreviewContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('importNovelModal')">å–æ¶ˆ</button>
                <button class="btn" onclick="previewImport()" id="previewImportBtn">ğŸ‘ï¸ é¢„è§ˆ</button>
                <button class="btn" onclick="confirmImport()" id="confirmImportBtn" style="display: none;">âœ… ç¡®è®¤å¯¼å…¥</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘é¡¹ç›®æ¨¡æ€æ¡† -->
    <div id="editProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç¼–è¾‘é¡¹ç›®</h2>
            </div>
            <div class="form-group">
                <label>ç±»å‹</label>
                <input type="text" id="editProjectGenre">
            </div>
            <div class="form-group">
                <label>èƒŒæ™¯è®¾å®š</label>
                <textarea id="editProjectBackground"></textarea>
            </div>
            <div class="form-group">
                <label>æ•…äº‹å¤§çº²</label>
                <textarea id="editProjectOutline"></textarea>
            </div>
            <div class="form-group">
                <label>å†™ä½œé£æ ¼</label>
                <input type="text" id="editProjectStyle" placeholder="ä¾‹å¦‚ï¼šç´§å‡‘ã€æ‚¬ç–‘ã€è¯—æ„...">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editProjectModal')">å–æ¶ˆ</button>
                <button class="btn" onclick="updateProject()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ è§’è‰²æ¨¡æ€æ¡† -->
    <div id="addCharacterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ·»åŠ è§’è‰²</h2>
            </div>
            <div class="form-group">
                <label>è§’è‰²åç§° *</label>
                <input type="text" id="newCharName" required>
            </div>
            <div class="form-group">
                <label>è§’è‰²æè¿° *</label>
                <textarea id="newCharDesc" placeholder="å¹´é¾„ã€èŒä¸šã€å¤–è²Œç‰¹å¾ç­‰..."></textarea>
            </div>
            <div class="form-group">
                <label>æ€§æ ¼ç‰¹å¾</label>
                <textarea id="newCharPersonality" placeholder="æè¿°è§’è‰²çš„æ€§æ ¼ç‰¹ç‚¹..."></textarea>
            </div>
            <div class="form-group">
                <label>è§’è‰²èƒŒæ™¯</label>
                <textarea id="newCharBackground" placeholder="è§’è‰²çš„è¿‡å¾€ç»å†..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addCharacterModal')">å–æ¶ˆ</button>
                <button class="btn" onclick="addCharacter()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘è§’è‰²æ¨¡æ€æ¡† -->
    <div id="editCharacterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç¼–è¾‘è§’è‰²</h2>
            </div>
            <div class="form-group">
                <label>è§’è‰²åç§°</label>
                <input type="text" id="editCharName" readonly style="background: #f0f0f0;">
            </div>
            <div class="form-group">
                <label>è§’è‰²æè¿° *</label>
                <textarea id="editCharDesc" placeholder="å¹´é¾„ã€èŒä¸šã€å¤–è²Œç‰¹å¾ç­‰..."></textarea>
            </div>
            <div class="form-group">
                <label>æ€§æ ¼ç‰¹å¾</label>
                <textarea id="editCharPersonality" placeholder="æè¿°è§’è‰²çš„æ€§æ ¼ç‰¹ç‚¹..."></textarea>
            </div>
            <div class="form-group">
                <label>è§’è‰²èƒŒæ™¯</label>
                <textarea id="editCharBackground" placeholder="è§’è‰²çš„è¿‡å¾€ç»å†..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editCharacterModal')">å–æ¶ˆ</button>
                <button class="btn" onclick="updateCharacter()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ ç« èŠ‚æ¨¡æ€æ¡† -->
    <div id="addChapterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ·»åŠ ç« èŠ‚</h2>
            </div>
            <div class="form-group">
                <label>ç« èŠ‚æ ‡é¢˜ *</label>
                <input type="text" id="newChapterTitle" required>
            </div>
            <div class="form-group">
                <label>ç« èŠ‚å†…å®¹ *</label>
                <textarea id="newChapterContent" style="min-height: 300px;" required></textarea>
            </div>
            <div class="form-group">
                <label>ç« èŠ‚æ‘˜è¦</label>
                <textarea id="newChapterSummary"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addChapterModal')">å–æ¶ˆ</button>
                <button class="btn" onclick="addChapter()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- æŸ¥çœ‹/ç¼–è¾‘ç« èŠ‚æ¨¡æ€æ¡† -->
    <div id="viewChapterModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="viewChapterTitle"></h2>
            </div>
            <div class="form-group">
                <label>ç« èŠ‚å†…å®¹</label>
                <textarea id="editChapterContent" style="min-height: 400px;"></textarea>
            </div>
            <div class="form-group">
                <label>ç« èŠ‚æ‘˜è¦</label>
                <textarea id="editChapterSummary"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="generateChapterSummary()">ç”Ÿæˆæ‘˜è¦</button>
                <button class="btn btn-secondary" onclick="closeModal('viewChapterModal')">å…³é—­</button>
                <button class="btn" onclick="updateChapter()">ä¿å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <!-- å…³ç³»å†å²è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="relationshipHistoryModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>ğŸ“Š å…³ç³»å˜åŒ–å†å²</h2>
            </div>
            <div style="padding: 20px;">
                <div id="relationshipHistoryContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('relationshipHistoryModal')">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- ç”Ÿæˆå¤§çº²é…ç½®æ¨¡æ€æ¡† -->
    <div id="generateOutlineModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>âœ¨ ç”Ÿæˆç« èŠ‚å¤§çº²</h2>
            </div>
            <div style="padding: 20px;">
                <div class="form-group">
                    <label>ç« èŠ‚æ•°é‡ï¼š</label>
                    <input type="number" id="outlineChapterCount" class="form-control" 
                           value="30" min="1" max="100" style="width: 150px;">
                    <small style="color: #999;">å»ºè®®ï¼š20-50ç« ï¼Œæœ€å¤š100ç« </small>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label>å¹³å‡ç« èŠ‚å­—æ•°ï¼š</label>
                    <input type="number" id="outlineChapterLength" class="form-control" 
                           value="3000" min="1000" max="10000" step="500" style="width: 150px;">
                    <small style="color: #999;">å»ºè®®ï¼š2000-5000å­—</small>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label>æ•…äº‹ç›®æ ‡/æœ€ç»ˆçŠ¶æ€ï¼š</label>
                    <textarea id="outlineStoryGoal" class="form-control" rows="3" 
                              placeholder="ä¾‹å¦‚ï¼šä¸»è§’æˆä¸ºæ­¦æ—ç›Ÿä¸»ï¼Œæ­å¼€çœŸç›¸å¹¶å¤ä»‡æˆåŠŸï¼Œå»ºç«‹å•†ä¸šå¸å›½ç­‰...&#10;&#10;å¯ä»¥ç•™ç©ºï¼ŒAIä¼šæ ¹æ®å°è¯´è®¾å®šè‡ªè¡Œè§„åˆ’"></textarea>
                    <small style="color: #999;">è®¾å®šæ•…äº‹çš„æœ€ç»ˆç›®æ ‡ï¼Œè®©AIç”Ÿæˆæ›´æœ‰æ–¹å‘æ€§çš„å¤§çº²</small>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                    <p style="margin: 0; color: #666; font-size: 14px;">
                        â±ï¸ é¢„è®¡ç”Ÿæˆæ—¶é—´ï¼š<span id="estimatedTime">2-3åˆ†é’Ÿ</span><br>
                        ğŸ’¡ ç”Ÿæˆåå¯ä»¥å¯¹å¤§çº²è¿›è¡Œç¼–è¾‘å’Œè°ƒæ•´
                    </p>
                </div>
                <div id="existingOutlineWarning" style="display: none; margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; color: #856404; font-size: 14px;">
                        âš ï¸ <strong>æ³¨æ„</strong><br>
                        å½“å‰å·²æœ‰å¤§çº²æ•°æ®ï¼Œé‡æ–°ç”Ÿæˆå°†æ¸…ç©ºæ‰€æœ‰æ—§å¤§çº²ï¼
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('generateOutlineModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmGenerateOutline()">å¼€å§‹ç”Ÿæˆ</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘å¤§çº²æ¨¡æ€æ¡† -->
    <div id="editOutlineModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>âœï¸ ç¼–è¾‘ç« èŠ‚å¤§çº²</h2>
            </div>
            <div style="padding: 20px;">
                <input type="hidden" id="editOutlineChapterNumber">
                
                <div class="form-group">
                    <label>ç« èŠ‚æ ‡é¢˜ï¼š</label>
                    <input type="text" id="editOutlineTitle" class="form-control" 
                           placeholder="ç®€æ´æœ‰åŠ›çš„ç« èŠ‚æ ‡é¢˜">
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>ç« èŠ‚æ¦‚è¦ï¼š</label>
                    <textarea id="editOutlineSummary" class="form-control" rows="4" 
                              placeholder="æè¿°ä¸»è¦æƒ…èŠ‚èµ°å‘ï¼ˆ80-150å­—ï¼‰"></textarea>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>å…³é”®äº‹ä»¶ï¼š</label>
                    <textarea id="editOutlineKeyEvents" class="form-control" rows="5" 
                              placeholder="æ¯è¡Œä¸€ä¸ªå…³é”®äº‹ä»¶ï¼Œä¾‹å¦‚ï¼š&#10;ä¸»è§’é‡åˆ°ç¥ç§˜è€äºº&#10;è·å¾—é‡è¦çº¿ç´¢&#10;ä¸åæ´¾åˆæ¬¡äº¤é”‹"></textarea>
                    <small style="color: #999;">æ¯è¡Œä¸€ä¸ªäº‹ä»¶</small>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>æ¶‰åŠè§’è‰²ï¼š</label>
                    <input type="text" id="editOutlineCharacters" class="form-control" 
                           placeholder="ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šå¼ ä¸‰,æå››,ç‹äº”">
                    <small style="color: #999;">ç”¨é€—å·åˆ†éš”å¤šä¸ªè§’è‰²</small>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>ç›®æ ‡å­—æ•°ï¼š</label>
                    <input type="number" id="editOutlineTargetLength" class="form-control" 
                           value="3000" min="1000" max="10000" step="500" style="width: 150px;">
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>åˆ›ä½œè¦ç‚¹ï¼š</label>
                    <textarea id="editOutlineNotes" class="form-control" rows="3" 
                              placeholder="åˆ›ä½œæ—¶éœ€è¦æ³¨æ„çš„è¦ç‚¹ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editOutlineModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveOutlineEdit()">ä¿å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <!-- é‡æ–°ç”ŸæˆèŒƒå›´å¤§çº²æ¨¡æ€æ¡† -->
    <div id="regenerateRangeModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>ğŸ”„ é‡æ–°ç”Ÿæˆå¤§çº²</h2>
            </div>
            <div style="padding: 20px;">
                <div style="padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                    <p style="margin: 0; color: #856404; font-size: 14px;">
                        âš ï¸ <strong>è­¦å‘Š</strong><br>
                        é‡æ–°ç”Ÿæˆå°†è¦†ç›–æ‰€é€‰ç« èŠ‚çš„åŸæœ‰å¤§çº²æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼<br>
                        å·²é€‰æ‹©ç« èŠ‚ï¼š<span id="regenerateChapterRange" style="font-weight: 600;"></span>
                    </p>
                </div>
                
                <div class="form-group">
                    <label>é˜¶æ®µç›®æ ‡/è¦è¾¾åˆ°çš„çŠ¶æ€ï¼š</label>
                    <textarea id="regenerateStageGoal" class="form-control" rows="3" 
                              placeholder="ä¾‹å¦‚ï¼šä¸»è§’æŒæ¡æ ¸å¿ƒæŠ€èƒ½ã€æ­å¼€ç¬¬ä¸€å±‚çœŸç›¸ã€ä¸åæ´¾æ­£å¼å¯¹ç«‹ç­‰...&#10;&#10;å¯ä»¥ç•™ç©ºï¼ŒAIä¼šæ ¹æ®æ•´ä½“æ•…äº‹ç›®æ ‡è‡ªè¡Œè§„åˆ’"></textarea>
                    <small style="color: #999;">è®¾å®šè¿™å‡ ç« çš„é˜¶æ®µæ€§ç›®æ ‡ï¼Œè®©å¤§çº²æ›´æœ‰é’ˆå¯¹æ€§</small>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>å¹³å‡ç« èŠ‚å­—æ•°ï¼š</label>
                    <input type="number" id="regenerateChapterLength" class="form-control" 
                           value="3000" min="1000" max="10000" step="500" style="width: 150px;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('regenerateRangeModal')">å–æ¶ˆ</button>
                <button class="btn btn-danger" onclick="confirmRegenerateRange()">ç¡®è®¤é‡æ–°ç”Ÿæˆ</button>
            </div>
        </div>
    </div>

    <!-- è¿½åŠ å¤§çº²æ¨¡æ€æ¡† -->
    <div id="appendOutlineModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>â• ç»§ç»­ç”Ÿæˆå¤§çº²</h2>
            </div>
            <div style="padding: 20px;">
                <div style="padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #2196F3; margin-bottom: 20px;">
                    <p style="margin: 0; color: #0d47a1; font-size: 14px;">
                        ğŸ’¡ <strong>ç»­å†™å¤§çº²</strong><br>
                        å½“å‰å·²æœ‰ï¼š<span id="currentOutlineCount" style="font-weight: 600;">0</span> ç« å¤§çº²<br>
                        AIå°†åŸºäºç°æœ‰å¤§çº²å†…å®¹ï¼Œç»§ç»­è§„åˆ’åç»­ç« èŠ‚
                    </p>
                </div>
                
                <div class="form-group">
                    <label>è¿½åŠ ç« èŠ‚æ•°ï¼š</label>
                    <input type="number" id="appendChapterCount" class="form-control" 
                           value="10" min="1" max="50" style="width: 150px;">
                    <small style="color: #999;">å»ºè®®ä¸€æ¬¡è¿½åŠ 10-20ç« </small>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>ç»­å†™éƒ¨åˆ†çš„ç›®æ ‡ï¼š</label>
                    <textarea id="appendStoryGoal" class="form-control" rows="3" 
                              placeholder="ä¾‹å¦‚ï¼šæœ€ç»ˆå‡»è´¥åæ´¾ã€å®Œæˆå¤ä»‡è®¡åˆ’ã€è¾¾æˆç»ˆæç›®æ ‡ç­‰...&#10;&#10;å¯ä»¥ç•™ç©ºï¼ŒAIä¼šå»¶ç»­ä¹‹å‰çš„æ•…äº‹ç›®æ ‡"></textarea>
                    <small style="color: #999;">è®¾å®šç»­å†™éƒ¨åˆ†è¦è¾¾åˆ°çš„æœ€ç»ˆçŠ¶æ€</small>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>å¹³å‡ç« èŠ‚å­—æ•°ï¼š</label>
                    <input type="number" id="appendChapterLength" class="form-control" 
                           value="3000" min="1000" max="10000" step="500" style="width: 150px;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('appendOutlineModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmAppendOutline()">å¼€å§‹ç”Ÿæˆ</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
